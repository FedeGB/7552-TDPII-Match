language: android
android:
    components:
        # Uncomment the lines below if you want to
        # use the latest revision of Android SDK Tools
        - platform-tools
        - tools

        # The BuildTools version used by your project
        - build-tools-23.0.2

        # The SDK version used to compile your project
        - android-23

        # Additional components
        - extra-google-google_play_services
        - extra-google-m2repository
        - extra-android-m2repository
        - addon-google_apis-google-23

        # Specify at least one system image,
        # if you need to run emulator(s) during your tests
        - sys-img-armeabi-v7a-android-23
        - sys-img-x86-android-23

    install:
        - ./gradlew assembleDebug

    before_script:
        - echo no | android create avd --force -n test -t android-23 --abi armeabi-v7a
        - emulator -avd test -no-audio -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
	- ./gradlew assembleDebug -PdisablePreDex
    	- ./gradlew assembleDebugAndroidTest -PdisablePreDex
    	- adb install app/build/outputs/apk/app-debug.apk
    	- adb install app/build/outputs/apk/app-debug-androidTest-unaligned.apk
    	- adb shell pm grant com.tallerii.match android.permission.SET_ANIMATION_SCALE
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 0 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 1 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 2 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 3 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 4 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
    	- adb shell am instrument -w  -e numShards 6 -e shardIndex 5 -e package com.tallerii.match com.tallerii.match.test/android.support.test.runner.AndroidJUnitRunner
